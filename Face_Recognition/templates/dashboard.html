<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Dashboard Monitoreo</title>
    <style>
        body {
            background: #111;
            color: #fff;
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
        }
        .btn {
            margin: 10px;
            padding: 10px 20px;
            background: #228be6;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .btn:hover { background: #1864ab; }
        .box { background: #222; padding: 15px; margin: 15px auto; width: 80%; border-radius: 8px; }
        input[type=text] { padding: 5px; font-size: 16px; border-radius: 4px; border: none; margin-right: 5px; }
        ul { list-style: none; padding-left: 0; }
    </style>
</head>
<body>
    <h1>Monitoreo de Camara</h1>

    <div class="box">
        <h2>Camara en vivo</h2>
        <img src="/video" width="640" height="480">
    </div>

    <div class="box">
        <h2>Ultimo evento: {{ ultimo_evento }}</h2>
        <h3>Eventos recientes:</h3>
        <ul>
            {% for evento in eventos %}
            <li>{{ evento[1] }} - {{ evento[0] }}</li>
            {% endfor %}
        </ul>
    </div>

    <div class="box">
        <h2>Personas registradas</h2>
        <ul id="lista_rostros">
            {% for nombre in nombres %}
            <li>{{ nombre }}</li>
            {% endfor %}
        </ul>
        <input type="text" id="nombre_nuevo" placeholder="Nombre nuevo">
        <button class="btn" onclick="finalizarAgregar()">Agregar rostro</button>
        <button class="btn" onclick="eliminarRostro()">Eliminar rostro</button>
        <p id="mensaje_error" style="color: red;"></p>
    </div>

    <div class="box">
        <h2>Alertas de correo</h2>
        <ul id="lista_correos">
            {% for correo in correos %}
            <li>{{ correo }} <button onclick="borrarCorreo('{{ correo }}')">Borrar</button></li>
            {% endfor %}
        </ul>
        <input type="text" id="nuevo_correo" placeholder="Correo nuevo">
        <button class="btn" onclick="agregarCorreo()">Agregar correo</button>
    </div>

    <script>
        function agregarCorreo() {
            let correo = document.getElementById("nuevo_correo").value;
            if(correo) {
                fetch("/agregar_correo", {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: `correo=${correo}`
                }).then(r => location.reload());
            }
        }

        function borrarCorreo(correo) {
            fetch("/borrar_correo", {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: `correo=${correo}`
            }).then(r => location.reload());
        }

        function finalizarAgregar() {
            let nombre = document.getElementById("nombre_nuevo").value;
            if(!nombre) {
                document.getElementById("mensaje_error").innerText = "Para finalizar escribe un nombre";
                return;
            }

            fetch("/agregar_rostro", {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: `nombre=${nombre}`
            }).then(r => location.reload());
        }

        function eliminarRostro() {
            let nombre = document.getElementById("nombre_nuevo").value;
            if(!nombre) { 
                document.getElementById("mensaje_error").innerText = "Escribe el nombre a eliminar";
                return;
            }

            fetch("/eliminar_rostro", {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: `nombre=${nombre}`
            }).then(r => location.reload());
        }
    </script>
</body>
</html>